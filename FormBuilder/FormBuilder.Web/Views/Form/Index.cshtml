@{
    Layout = "_FormLayout";
}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Saved Forms</h2>
    <a href="/Form/Create" class="btn btn-success btn-lg">Create New Form</a>
</div>

<div class="table-responsive">
    <table id="formsTable" class="table table-striped table-hover align-middle" style="width:100%">
        <thead class="table-dark">
            <tr>
                <th>Form Title</th>
                <th class="text-center">Action</th>
            </tr>
        </thead>
    </table>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
        $(function () {
            $('#formsTable').DataTable({
                serverSide: true,
                processing: true,
                responsive: true,
                ajax: function (data, callback) {
                    const start = data.start;
                    const length = data.length;
                    const search = data.search.value;

                    $.get('/Form/Paged', { start: start, length: length, search: search }, function (res) {
                        callback({
                            recordsTotal: res.recordsTotal,
                            recordsFiltered: res.recordsFiltered,
                            data: res.data.map(function (r) {
                                return [
                                    r.title,
                                    `<div class="d-flex justify-content-center gap-2">
                                        <a class="btn btn-sm btn-primary" href="/Form/Preview/${r.formId}">Preview</a>
                                    </div>`
                                ];
                            })
                        });
                    });
                },
                columns: [
                    { title: "Form Title" },
                    { title: "Action", orderable: false, searchable: false }
                ],
                language: {
                    emptyTable: "No forms found.",
                    processing: "Loading..."
                }
            });
        });
    </script>
}
